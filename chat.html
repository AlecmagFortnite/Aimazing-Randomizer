<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Chat</title>

<style>
:root{
  --main:var(--saved,#075E54);
  --accent:#25D366;
  --bg:#ECE5DD;
}
body{
  margin:0;
  font-family:system-ui;
  background:var(--bg);
  height:100vh;
  display:flex;
  flex-direction:column;
}
header{
  background:var(--main);
  color:white;
  padding:12px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
header input,select{
  border:none;
  border-radius:6px;
  padding:4px;
}
#chat{
  flex:1;
  padding:10px;
  overflow-y:auto;
  display:flex;
  flex-direction:column;
  gap:8px;
}
.msg{
  max-width:75%;
  padding:10px 14px;
  border-radius:18px;
}
.me{align-self:flex-end;background:#DCF8C6}
.ai{align-self:flex-start;background:var(--accent);color:white}
.sticker{font-size:2rem}
footer{
  display:flex;
  gap:5px;
  padding:8px;
}
footer input{flex:1;border-radius:10px;border:none;padding:10px}
footer button{border:none;border-radius:10px;padding:10px;background:var(--accent);color:white}
.settings{
  padding:6px;
  display:flex;
  gap:5px;
}
</style>
</head>

<body>

<header>
  <div>
    <input id="name">
    <div id="nr"></div>
  </div>
  <div>
    <select id="mode">
      <option value="friend">Freund</option>
      <option value="love">Liebe</option>
      <option value="science">Wissenschaft</option>
    </select>
    <button onclick="back()">â¬…</button>
  </div>
</header>

<div class="settings">
  <label>Farbe:</label>
  <input type="color" id="color">
</div>

<div id="chat"></div>

<footer>
  <button onclick="sendSticker()">ğŸ˜„</button>
  <input id="inp" placeholder="Nachricht...">
  <button onclick="send()">â¤</button>
</footer>

<script>
let chats=JSON.parse(localStorage.getItem("chats"));
let id=new URLSearchParams(location.search).get("id");
let c=chats[id];

name.value=c.name;
nr.textContent=c.number;
mode.value=c.mode;

const colors=localStorage.getItem("color");
if(colors) document.documentElement.style.setProperty("--saved",colors);

color.value=colors||"#075E54";
color.oninput=()=>{
  localStorage.setItem("color",color.value);
  document.documentElement.style.setProperty("--saved",color.value);
};

name.onchange=()=>{c.name=name.value;save();}
mode.onchange=()=>{c.mode=mode.value;save();}

const responses={
friend:[
"Hey, wie gehtâ€™s dir?",
"Was machst du gerade?",
"Freut mich von dir zu hÃ¶ren!",
"Alles klar bei dir?",
"Ich bin immer fÃ¼r dich da."
],
love:[
"Ich denke an dich â¤ï¸",
"Du bedeutest mir viel",
"Ich mag unsere GesprÃ¤che",
"Du bringst mein Herz zum LÃ¤cheln",
"Ich fÃ¼hle mich dir nah"
],
science:[
"Die Erde ist 4,5 Milliarden Jahre alt.",
"Licht ist unglaublich schnell.",
"Unser Gehirn ist extrem komplex.",
"Zeit ist relativ.",
"Das Universum dehnt sich aus."
]
};

function aiReply(){
  let arr=responses[c.mode];
  let last=c.history.slice(-8);
  let pick;
  do{pick=arr[Math.floor(Math.random()*arr.length)];}
  while(last.includes(pick));
  c.history.push(pick);
  if(c.history.length>20) c.history.shift();
  add(pick,"ai");
}

function add(t,cls){
  let d=document.createElement("div");
  d.className="msg "+cls;
  d.textContent=t;
  chat.appendChild(d);
  chat.scrollTop=chat.scrollHeight;
}

function send(){
  if(!inp.value)return;
  add(inp.value,"me");
  inp.value="";
  setTimeout(aiReply,600);
}

function sendSticker(){
  let d=document.createElement("div");
  d.className="msg me sticker";
  d.textContent=["ğŸ˜„","ğŸ˜‚","â¤ï¸","ğŸ”¥","ğŸ¥¶","ğŸ¤¯"][Math.floor(Math.random()*6)];
  chat.appendChild(d);
  setTimeout(aiReply,600);
}

function save(){chats[id]=c;localStorage.setItem("chats",JSON.stringify(chats));}
function back(){save();location.href="index.html";}
</script>
</body>
</html>
